<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Transa√ß√£o na Rede Tenderly</title>
  <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 20px; }
    .card {
      max-width: 650px; margin: auto; background: #fff; padding: 20px;
      border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .field { margin-bottom: 12px; }
    .field label { font-weight: bold; }
    .hash, .address { word-break: break-all; }
    button {
      padding: 8px 16px; background: #4CAF50; border: none;
      border-radius: 5px; color: white; cursor: pointer;
    }
    button.copy { background: #555; margin-left: 10px; }
  </style>
</head>
<body>
  <div class="card">
    <h2>üîç Detalhes da Transa√ß√£o (Ethereum / USDT)</h2>
    <div class="field">
      <label for="txHash">Hash da Transa√ß√£o:</label><br>
      <input type="text" id="txHash" size="70" placeholder="Cole a hash aqui">
      <button onclick="fetchTx()">Buscar</button>
    </div>
    <div id="result" style="display:none;">
      <div class="field"><label>Hash:</label> <span class="hash" id="hashText"></span> <button class="copy" onclick="copyHash()">üìã Copiar</button></div>
      <div class="field"><label>De:</label> <span id="from"></span></div>
      <div class="field"><label>Para:</label> <span id="to"></span></div>
      <div class="field"><label>Valor:</label> <span id="value"></span></div>
      <div class="field"><label>Status:</label> <span id="status"></span></div>
      <div class="field"><label>Bloco:</label> <span id="blockNumber"></span></div>
      <div class="field"><label>Gas Usado:</label> <span id="gasUsed"></span></div>
      <div class="field" id="erc20Section" style="display:none;">
        <label>Token ERC20:</label>
        <div class="field"><label>Token:</label> <span id="erc20Token"></span></div>
        <div class="field"><label>Valor Transferido:</label> <span id="erc20Value"></span></div>
      </div>
    </div>
  </div>

  <script>
    const provider = new ethers.providers.JsonRpcProvider("https://virtual.mainnet.rpc.tenderly.co/1982c95f-1cdd-43dc-a73b-9223e1800cea");

    const ERC20_ABI = [
      "function decimals() view returns (uint8)",
      "function symbol() view returns (string)",
    ];

    async function fetchTx() {
      const hash = document.getElementById('txHash').value;
      try {
        const tx = await provider.getTransaction(hash);
        const receipt = await provider.getTransactionReceipt(hash);
        if (!tx || !receipt) throw new Error("Transa√ß√£o n√£o encontrada!");

        document.getElementById('hashText').textContent = hash;
        document.getElementById('from').textContent = tx.from;
        document.getElementById('to').textContent = tx.to || 'Contrato';
        document.getElementById('value').textContent = ethers.utils.formatEther(tx.value) + " ETH";
        document.getElementById('status').textContent = receipt.status === 1 ? "‚úÖ Sucesso" : "‚ùå Falhou";
        document.getElementById('blockNumber').textContent = tx.blockNumber;
        document.getElementById('gasUsed').textContent = receipt.gasUsed.toString();
        document.getElementById('result').style.display = 'block';

        // Verifica se √© uma transfer√™ncia ERC20
        const transferTopic = ethers.utils.id("Transfer(address,address,uint256)");
        const transferLog = receipt.logs.find(log => log.topics[0] === transferTopic);

        if (transferLog) {
          const tokenAddress = transferLog.address;
          const contract = new ethers.Contract(tokenAddress, ERC20_ABI, provider);
          const symbol = await contract.symbol();
          const decimals = await contract.decimals();

          const valueHex = transferLog.data;
          const rawValue = ethers.BigNumber.from(valueHex);
          const valueFormatted = ethers.utils.formatUnits(rawValue, decimals);

          document.getElementById('erc20Section').style.display = 'block';
          document.getElementById('erc20Token').textContent = `${symbol} (${tokenAddress})`;
          document.getElementById('erc20Value').textContent = `${valueFormatted} ${symbol}`;
        } else {
          document.getElementById('erc20Section').style.display = 'none';
        }

      } catch (err) {
        alert("Erro: " + err.message);
      }
    }

    function copyHash() {
      const hash = document.getElementById('txHash').value;
      navigator.clipboard.writeText(hash);
      alert("Hash copiada!");
    }
  </script>
</body>
</html>
